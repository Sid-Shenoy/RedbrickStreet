1) HUD module (`hud.ts`)

1.1) Intent

1.1.1) Provide a bottom-left on-screen HUD overlay:
1.1.1.1) a minimap showing plot surfaces and the road (with distinct colors)
1.1.1.2) a health bar with a continuous green->red gradient as health decreases
1.1.1.3) a stamina bar in blue that darkens as stamina lowers and darkens slightly while sprinting
1.1.1.4) numeric values beside both bars (value/max)

1.2) Exported function

1.2.1) Export: `createHud(scene, camera, houses) -> hudApi`
1.2.2) `houses` must be `HouseWithModel[]` and the minimap must be derived from:
1.2.2.1) `house.model.plot.regions` for plot surfaces
1.2.2.2) a global road rectangle at x in [0, 230], z in [30, 40]
1.2.3) The HUD must attach DOM elements to `document.body`.
1.2.4) The HUD overlay must use `pointer-events: none` so it does not block pointer lock / canvas clicks.

1.3) Minimap behavior (hard)

1.3.1) The minimap must show a 40m x 24m area centered on the player.
1.3.2) The minimap must rotate to reflect player orientation so that "forward" is always up.
1.3.3) The minimap must draw a centered triangular arrow representing the player:
1.3.3.1) the arrow must always point "forward"/up on the minimap.

1.3.4) The minimap must draw a small "house" icon at the player's spawn point.
1.3.4.1) The spawn point must be captured once when `createHud` is called (world XZ).
1.3.4.2) The icon must be drawn in minimap screen-space so it stays upright (does not rotate with the minimap), but its position must be computed from world coordinates under the minimap transform.
1.3.4.3) If the spawn point lies outside the visible minimap area, the icon must be clamped to the minimap edge (with minimal padding), preserving the direction from the player.
1.3.4.4) When the spawn/home icon is clamped (off-map), it must be filled with grey.
1.3.4.5) The spawn/home icon must always be visible.

1.4) Stamina behavior (hard)

1.4.1) Sprint input must be Shift (ShiftLeft or ShiftRight).
1.4.2) When sprinting and moving, stamina must decrease continuously.
1.4.3) When not sprinting, stamina must replenish gradually.
1.4.4) Sprinting must increase `camera.speed` while stamina remains above 0.

1.5) Damage flash vignette (hard)

1.5.1) Whenever HUD health decreases (i.e., `setHealth` is called with a value lower than the previous health),
       the screen must flash with a red vignette effect.
1.5.2) The vignette must be full-screen, centered clear with red edges, and must not block pointer lock / clicks
       (`pointer-events: none`).
1.5.3) The flash must be brief (single pulse) and may restart if damage occurs again before it finishes.

2) Weapon UI module (`weaponUi.ts`)

2.1) Intent

2.1.1) Provide:
2.1.1.1) A Tab-activated weapon wheel (4 options):
2.1.1.1.1) Unarmed
2.1.1.1.2) SmokeShot
2.1.1.1.3) SprayShot
2.1.1.1.4) BlastShot
2.1.1.2) Number-key weapon switching (works whether wheel is visible or not)
2.1.1.3) A bottom-right weapon-in-hand image when armed
2.1.1.4) A weapon icon shown above the HUD (icons must be aspect-ratio-safe)
2.1.1.5) Click/hold shooting with a rapid 5-frame animation sequence and `gunshot.mp3`

2.2) Exported function

2.2.1) Export: `createWeaponUi(scene, canvas, weapons) -> weaponUiApi`
2.2.2) Inputs:
2.2.2.1) `scene` is used for lifecycle cleanup via `scene.onDisposeObservable`
2.2.2.2) `canvas` is the Babylon render canvas
2.2.2.3) `weapons` is loaded from `/config/weapons.json` and must follow `WeaponConfig` in `types/config.ts`

2.3) Weapon wheel behavior (hard)

2.3.1) Pressing Tab must toggle the weapon wheel visibility.
2.3.2) While visible:
2.3.2.1) the wheel must display exactly 4 options (Unarmed + 3 weapons)
2.3.2.2) clicking a segment must equip that option and close the wheel
2.3.2.3) pressing keys 1ΓÇô4 must equip and close the wheel
2.3.3) Tab default browser behavior must be prevented.

2.4) Number-key equipping (hard)

2.4.1) Key 1 must equip Unarmed.
2.4.2) Keys must equip weapons based on `weapons.json`:
2.4.2.1) `toEquip` determines which number equips each weapon.
2.4.3) Number-key equipping must work whether or not the wheel is visible.

2.4.4) Reload sound on weapon equip (hard)
2.4.4.1) When switching to a weapon (SmokeShot / SprayShot / BlastShot), play `assets/audio/sfx/reload.mp3` once.
2.4.4.2) This must trigger whether the switch happens via number keys or via weapon wheel.
2.4.4.3) This must NOT play when switching to Unarmed.

2.4.5) Equip transition animation (hard)
2.4.5.1) When switching to a weapon (SmokeShot / SprayShot / BlastShot), the weapon-in-hand image must animate:
2.4.5.1.1) quickly move downward until it is fully off-screen,
2.4.5.1.2) equip the new weapon while hidden,
2.4.5.1.3) quickly move back up to its normal position.
2.4.5.2) This must trigger whether the switch happens via number keys or via weapon wheel.

2.5) Weapon visuals (hard)

2.5.1) When Unarmed:
2.5.1.1) no weapon-in-hand image is shown
2.5.1.2) shooting is disabled
2.5.1.3) the weapon icon above the HUD must display "≡ƒÜ½"
2.5.2) When a weapon is equipped:
2.5.2.1) show the corresponding `grip.png` at the bottom-right
2.5.2.2) the weapon-in-hand image height must be exactly `${weapon.handHeightVh}vh`
2.5.2.2.1) Allowed values are 64 and 80
2.5.2.2.2) Only BlastShot should use 80; all other weapons must use 64
2.5.2.3) show the weapon `icon.png` above the HUD
2.5.2.3.1) icons must be displayed with `object-fit: contain` to handle varying aspect ratios
2.5.2.4) show the correct crosshair from:
2.5.2.4.1) `assets/weapons/crosshairs/small.svg`
2.5.2.4.2) `assets/weapons/crosshairs/large.svg`
2.5.2.4.3) chosen by `weapon.crosshair`

2.6) Shooting (hard)

2.6.1) When a weapon is equipped, holding left mouse must fire repeatedly at `weapon.fireRate` shots/second.
2.6.2) Each shot must animate frames in this exact order:
2.6.2.1) grip -> pull -> fire -> pull -> grip
2.6.3) Each shot must play `assets/audio/sfx/gunshot.mp3`.
2.6.4) Playback volume must be `weapon.shotVolume / 100` (clamped to [0,1]).

2.7) Ammunition display (hard)

2.7.1) When a weapon is equipped (not Unarmed), an ammo readout must be shown below the weapon-in-hand image.
2.7.2) The readout must clearly show:
2.7.2.1) current rounds in the clip
2.7.2.2) clip size
2.7.2.3) reserve rounds (ammo not currently loaded)
2.7.3) The readout must NOT be redundant:
2.7.3.1) it must NOT display both reserve and total ammo simultaneously
2.7.3.2) it must NOT display both clip size and capacity simultaneously
2.7.4) When Unarmed, the ammo readout must not be visible.

Example format (one line):
`AMMO 98/120 (8/30)`

2.8) Reloading (hard)

2.8.1) Each weapon must track:
2.8.1.1) rounds currently loaded in the clip
2.8.1.2) reserve rounds carried (not in clip)
2.8.2) When the clip reaches 0 and reserve ammo is available, the weapon must reload.
2.8.3) Reload animation (hard):
2.8.3.1) Reload must use the exact same transition animation as weapon switching (down off-screen, then back up),
2.8.3.2) but re-equipping the currently equipped weapon (same weapon).
2.8.3.3) After the weapon-in-hand image has moved fully off-screen, it must remain hidden for 0.8 seconds before returning.
2.8.3.4) During reload, `assets/audio/sfx/reload.mp3` must play once 0.4 seconds after the weapon-in-hand image has moved fully off-screen (i.e. halfway through the 0.8s hidden delay).
2.8.4) While reloading:
2.8.4.1) shooting must be disabled
2.8.4.2) the ammo readout must update after reload completes.
2.8.5) Reloading must move ammo from reserve into the clip up to `weapon.clipSize`.

2.9) Home ammo refill (hard)

2.9.1) The weapon UI must capture the player's home position (world XZ) once when `createWeaponUi` is called.
2.9.2) If the player is within 3.0 meters of home (2D distance in XZ):
2.9.2.1) ammo must automatically refill to full for all weapons.
2.9.3) "Full" means:
2.9.3.1) clip rounds = `weapon.clipSize`
2.9.3.2) reserve rounds = `weapon.capacity - weapon.clipSize`

2.10) Ammo UI
2.10.1) Home reload note (hard)
2.10.1.1) While within 3.0m of home (XZ), show a bottom-center note: "All weapons were reloaded".
2.10.1.2) When outside 3.0m of home (XZ), the note must not be visible.
2.10.2) Ammo readout red state (hard)
2.10.2.1) Only when the equipped weapon has no ammo at all (clip=0 AND reserve=0), the ammo readout text must be red.

2.11) Zombie counter (hard)

2.11.1) The weapon UI must show a top-right, always-visible zombie counter.
2.11.2) It must show remaining zombies out of the initial total.
2.11.3) Format (one line):
`ZOMBIES 17/25`

2.11.4) The `weaponUiApi` must provide:
2.11.4.1) `setZombieCount(alive: number, total: number) -> void`

3) Intro module (`intro.ts`)

3.1) Intent

3.1.1) Provide a full-screen intro/briefing overlay at boot:
3.1.1.1) A short story briefing themed to Redbrick Street
3.1.1.2) A clear list of controls
3.1.1.3) A "Press Space to begin" prompt

3.2) Exported function

3.2.1) Export: `createIntroOverlay(scene) -> introUiApi`
3.2.2) The intro UI must attach DOM elements to `document.body`.
3.2.3) The overlay must be visible immediately when created and remain until started or disposed.
3.2.4) Pressing Space must start the game:
3.2.4.1) start trigger is a `keydown` event where `ev.code === "Space"`
3.2.4.2) it must ignore key repeat
3.2.4.3) it must prevent default Space behavior for that key press

3.3) Lifecycle and cleanup (hard)

3.3.1) The intro overlay must remove all DOM nodes and event listeners when it closes.
3.3.2) The intro overlay must also clean itself up when `scene` is disposed.

3.4) API format

3.4.1) The returned `introUiApi` must provide:
3.4.1.1) `waitForStart() -> Promise<void>` which resolves when the intro is started (Space key or Start mission button), and closes the overlay
3.4.1.2) `dispose() -> void` which closes the overlay without starting

3.5) Start briefing audio (hard)

3.5.1) When the intro overlay is started (via Space key or Start mission button), play:
3.5.1.1) `assets/audio/dialogue/conversations/start.mp3`
3.5.2) The audio must play exactly once per intro start.
3.5.3) The audio must begin immediately when the intro closes/starts.

Example usage:
```
const intro = createIntroOverlay(scene);
await intro.waitForStart();
// now enable gameplay input and HUD
```

4) "Wasted" overlay module (`wasted.ts`)

4.1) Intent

4.1.1) When the player dies (health reaches 0), provide a full-screen death overlay:
4.1.1.1) the screen must gradually fade to black
4.1.1.2) `assets/wasted-text.gif` must appear along with the fade
4.1.1.3) `assets/audio/sfx/wasted.mp3` must play when the overlay triggers

4.2) Exported function

4.2.1) Export: `createWastedOverlay(scene) -> wastedApi`
4.2.2) The overlay must attach DOM elements to `document.body`.
4.2.3) The overlay must use `pointer-events: none`.

4.3) Behavior (hard)

4.3.1) `wastedApi.trigger()` must:
4.3.1.1) show the overlay
4.3.1.2) start a gradual fade to black
4.3.1.3) fade in the wasted gif along with the screen fade
4.3.1.4) play `assets/audio/sfx/wasted.mp3` exactly once
4.3.2) `wastedApi.trigger()` must be idempotent (calling it multiple times must not re-trigger audio or restart the fade).

4.4) Lifecycle and cleanup (hard)

4.4.1) The overlay must remove all DOM nodes when disposed.
4.4.2) The overlay must also clean itself up when `scene` is disposed.